<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>WhatDoWeDoNow!</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <script src="phaser.min.js"></script>
    </head>
<body>
    <div>HELLO</div>

    <div id="middle">
        <div id="phaser_window"></div>
    </div>
        
<script>

    var play = play || {};
    play.game = new Phaser.Game(480, 480, Phaser.AUTO, 'phaser_window', { preload: preload, create: create, update: update });
    
    var sfx;
    
    function preload() {
        this.game.load.image('square', 'purple_sq.png');
        this.game.load.image('tile', 'green_sq.png');
        
        this.game.load.audio('sfx', ['sound/random_sound1.wav']);
    }
    
    var player_group;
    var tile_group;
    
    var player;
    var player2;

    function create() {
        this.game.physics.startSystem(Phaser.Physics.ARCADE);
        sfx = play.game.add.audio('sfx');
        
        setup_players();
        generate_terrain();
    }
    
    function setup_players() {
        
        player_group = play.game.add.group();
        player = player_group.create(64, 64, 'square');
        player2 = player_group.create(128, 128, 'square');
        
        play.game.physics.arcade.enable(player);
        player.body.collideWorldBounds = true;
        
        play.game.physics.arcade.enable(player2);
        player2.body.collideWorldBounds = true;
    }
    
    function generate_terrain() {
        tile_group = play.game.add.group();
        tile_group.enableBody = true;
        
        var tiles = 20;
        for (var n = 0; n < tiles; n++) {
            var x = Math.floor(Math.random() * 15) * 32;
            var y = Math.floor(Math.random() * 15) * 32;
            var tile = tile_group.create(x, y, 'tile');
            tile.body.immovable = true;
        }
    }
    
    var delay = 200;
    var player1_move_time = 0;
    var player2_move_time = 0;
    
    function update() {
        //console.log("hej!");
        
        //sfx.play('');

        
        if (play.game.time.now > player1_move_time) {
            update_player1_movement();
            player1_move_time = play.game.time.now + delay;
        }

        if (play.game.time.now > player2_move_time) {
            update_player2_movement();
            player2_move_time = play.game.time.now + delay;
        }
        
        play.game.physics.arcade.collide(player, player2, this.death_handler, null, this);
        play.game.physics.arcade.collide(player_group, tile_group);
    }
    
    function death_handler() {
        player.destroy();
        player2.destroy();
    }
    
    function update_player1_movement() {
        var cursors = play.game.input.keyboard.createCursorKeys();
        player.body.velocity.x = 0;
        player.body.velocity.y = 0;
        
        var speed = 150;
        var jump_length = 32;
        
        if (cursors.right.isDown) {
            //player.body.velocity.x = speed;
            player.body.position.x += jump_length;
        }
        else if (cursors.left.isDown) {
            //player.body.velocity.x = -speed;
            player.body.position.x -= jump_length;
        }
        else if (cursors.up.isDown) {
            //player.body.velocity.y = -speed;
            player.body.position.y -= jump_length;
        }
        else if (cursors.down.isDown) {
            //player.body.velocity.y = speed;
            player.body.position.y += jump_length;
        }
    }
    
    function update_player2_movement() {
        //var cursors = play.game.input.keyboard.;
        var upKey = play.game.input.keyboard.addKey(Phaser.Keyboard.W);
        var leftKey = play.game.input.keyboard.addKey(Phaser.Keyboard.A);
        var rightKey = play.game.input.keyboard.addKey(Phaser.Keyboard.D);
        var downKey = play.game.input.keyboard.addKey(Phaser.Keyboard.S);

        player2.body.velocity.x = 0;
        player2.body.velocity.y = 0;
        
        var speed = 150;
        
        if (upKey.isDown) {
            player2.body.velocity.y = -speed;
        }
        else if (leftKey.isDown) {
            player2.body.velocity.x = -speed;
        }
        else if (rightKey.isDown) {
            player2.body.velocity.x = speed;
        }
        else if (downKey.isDown) {
            player2.body.velocity.y = speed;
        }
    }
    
    

</script>
</body>
</html>
